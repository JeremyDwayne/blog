<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Threads And Queues In Ruby | Jeremy Winterberg - Staff Software Engineer</title><meta name=keywords content="post"><meta name=description content="Concurrent processing in Ruby is an exciting topic which I explore in this coding exercise."><meta name=author content="Me"><link rel=canonical href=https://www.jeremydwayne.com/posts/threads_and_queues_in_ruby/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.jeremydwayne.com/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.jeremydwayne.com/images/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.jeremydwayne.com/images/favicon-32x32.png><link rel=apple-touch-icon href=https://www.jeremydwayne.com/images/apple-touch-icon.png><link rel=mask-icon href=https://www.jeremydwayne.com/images/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Threads And Queues In Ruby"><meta property="og:description" content="Concurrent processing in Ruby is an exciting topic which I explore in this coding exercise."><meta property="og:type" content="article"><meta property="og:url" content="https://www.jeremydwayne.com/posts/threads_and_queues_in_ruby/"><meta property="og:image" content="https://www.jeremydwayne.com/images/headerlogo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-03T02:12:44-06:00"><meta property="article:modified_time" content="2023-01-03T02:12:44-06:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.jeremydwayne.com/images/headerlogo.png"><meta name=twitter:title content="Threads And Queues In Ruby"><meta name=twitter:description content="Concurrent processing in Ruby is an exciting topic which I explore in this coding exercise."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.jeremydwayne.com/posts/"},{"@type":"ListItem","position":2,"name":"Threads And Queues In Ruby","item":"https://www.jeremydwayne.com/posts/threads_and_queues_in_ruby/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Threads And Queues In Ruby","name":"Threads And Queues In Ruby","description":"Concurrent processing in Ruby is an exciting topic which I explore in this coding exercise.","keywords":["post"],"articleBody":"I recently tried solving a coding challenge that required concurrent processing of data. This is something I’ve honestly never done before in code. At work, almost everything is event driven, and tasks that do need to be done asynchronously or concurrently have been done through systems like Sidekiq, Redis or message queues like Kafka.\nI want to introduce the problem to you, go over my solution, and describe my thought process along the way.. as best I can. I’m in no way trying to even claim I solved the problem correctly, or used Threads and Queues in the way they’re intended. What I can do, however, is document what I did and continue to learn and grow from here.\nI found this to be incredibly engaging for me, because it was a new concept that I hadn’t attempted to write code for before.\nThe Problem A user’s identity is flagged, and they must meet with a support rep to validate they are who they say they are. Design a system that ingests the users, assigns a support rep to the case, and validates their identity.\nRequirements A new user will be added to the queue every 2 seconds An identity will be verified after 4 seconds A support rep can only work on one validation at a time. Expected Output User has been verified and removed from the queue Metrics to demonstrate the progress of the queue. Provided data users = [ { id: 1 }, { id: 2 }, { id: 3 }, { id: 4 }, { id: 5 }, { id: 6 }, { id: 7 }, { id: 8 }, { id: 9 }, { id: 10 } ] support_reps = [ { id: 1 }, { id: 2 }, { id: 3 }, { id: 4 } ] The Attempted Solution Since we’re building out a queue data structure, we can use the Queue class that Ruby provides. The alternative approach, and what I used initially, is to use an array as a basic queue.\nSomething like this technically works, but is a basic approach and isn’t as straightforward to process in parallel.\nusers = [] users.push({ id: 1}) users.shift Once I remembered there actually is a standard Queue class, I noticed that it intrinsically supports Threads. Threads are how I plan on processing multiple users simultaneously.\nclass VerificationQueue attr_reader :users, :support_reps def initialize @users = Queue.new @support_reps = [] end def verify_users workers = support_reps.size.times.map do Thread.new do begin while user = users.pop support_rep = available_support_rep if support_rep \u0026\u0026 user support_rep.update_status('busy') session = VerificationSession.new(user, support_rep) self.to_s until(session.verified?) end support_rep.update_status('available') puts \"User #{user[:id]} has been verified and removed from the queue\" puts session.to_s end end rescue ThreadError end end end workers.map(\u0026:join) end def available_support_rep support_reps.each do |ref| next if ref.status == 'busy' return ref end end def add_user(user) users.push(user) puts \"User #{user[:id]} added to the queue.\" end def add_support_rep(support_rep) support_reps.push(support_rep) puts \"support_rep #{support_rep.id} has started working.\" end def to_s puts \"==== Queue Status ====\" puts \"Users still in queue: #{users.size}\" puts \"support_reps\" puts support_reps puts \"======================\" end I spin up a new thread for each support rep, so the code can verify the users simultaneously. When each support rep becomes available again, it picks up the next user in the queue.\nThe algorithm I used to select an available support rep isn’t elegant. It just loops through the reps and chooses the next available. If I really cared about work-life balance I would implement some sort of weighted priority system that could determine how much work each rep had taken on recently.\nThe verification process is managed through a VerificationSession. Due to the simplicity of the challenge, it just tracks the time elapsed and completes after 4 seconds. In a real implementation you would trigger whatever logic would be necessary to verify the identity of a user.\nclass VerificationSession TIME_COMPLETED = 4.0 attr_reader :user, :support_rep, :start_time def initialize(user, support_rep) @user = user @support_rep = support_rep @start_time = Process.clock_gettime(Process::CLOCK_MONOTONIC) end def elapsed_time end_time = Process.clock_gettime(Process::CLOCK_MONOTONIC) end_time - start_time end def verified? elapsed_time \u003e= TIME_COMPLETED end def to_s \"VerificationSession: User: #{user[:id]} Rep: #{support_rep} Elapsed: #{elapsed_time.round(4)}\" end end There’s a couple of approaches we can take to build out our SupportRep objects. The first that came to mind was creating a class which would allow future expansion of functionality. The more simplistic route would be to create a Struct. What I struggle with in these coding challenges is the trade-offs between expressing good design and keeping the solution short and sweet.\nSo first is the more traditional class route that I actually wrote, followed by how I think I would approach this in the future with a Struct.\nclass SupportRep attr_reader :id, :status def initialize(id, status = 'available') @id = id @status = status end def update_status(status) @status = status end def to_s \"id: #{id}, status: #{status}\" end end Here’s an example of how I might do it with a Struct.\nSupportRep = Struct.new(:id, :status) queue = VerificationQueue.new for id in 1..4 do support_rep = SupportRep.new(id, 'available') queue.add_support_rep(support_rep) end # Then when I need to change the status I could just do support_rep.status = 'busy' Exploring the alternate Struct method is for another time. For now let’s try to run it with the code as is using classes.\nLet’s Try To Run It! Here is some simple code to build up the data we need to run this. In order to simulate a new user being added every 2 seconds, I also am using threads to start the validation queue and then add users to it.\nusers = [ { id: 1 }, { id: 2 }, { id: 3 }, { id: 4 }, { id: 5 }, { id: 6 }, { id: 7 }, { id: 8 }, { id: 9 }, { id: 10 } ] support_reps = [ { id: 1 }, { id: 2 }, { id: 3 }, { id: 4 } ] start_time = Process.clock_gettime(Process::CLOCK_MONOTONIC) queue = VerificationQueue.new support_reps.map do |ref| support_rep = SupportRep.new(ref[:id]) queue.add_support_rep(support_rep) end threads = [] queue.add_user(users.shift) threads \u003c\u003c Thread.new do begin queue.verify_users rescue ThreadError end end threads \u003c\u003c Thread.new do begin while user = users.shift start_time = Process.clock_gettime(Process::CLOCK_MONOTONIC) until(elapsed_time(start_time) \u003e= 2.0) end queue.add_user(user) end rescue ThreadError end end threads.map { |thread| thread.join(10) } queue.to_s def elapsed_time(start_time) end_time = Process.clock_gettime(Process::CLOCK_MONOTONIC) end_time - start_time end puts \"/nElapsed Time: #{elapsed_time(start_time).round(4)}\" The output is a bit messy, but you can get the gist of it. It processes 10 users in 19 seconds, each user taking 4 seconds. Without using threads, this would’ve taken a minimum of 40 seconds. Add more support reps and it takes even less time.\n❯ ruby threads.rb support_rep 1 has started working. support_rep 2 has started working. support_rep 3 has started working. support_rep 4 has started working. User 1 added to the queue. ==== Queue Status ==== Users still in queue: 0 support_reps id: 1, status: busy id: 2, status: available id: 3, status: available id: 4, status: available ====================== User 2 added to the queue. ==== Queue Status ==== Users still in queue: 0 support_reps id: 1, status: busy id: 2, status: busy id: 3, status: available id: 4, status: available ====================== User 1 has been verified and removed from the queue VerificationSession: User: 1 Rep: id: 1, status: available Elapsed: 4.0 User 3 added to the queue. ==== Queue Status ==== Users still in queue: 0 support_reps id: 1, status: busy id: 2, status: busy id: 3, status: available id: 4, status: available ====================== User 4 added to the queue. User 2 has been verified and removed from the queue VerificationSession: User: 2 Rep: id: 2, status: available Elapsed: 4.0 ==== Queue Status ==== Users still in queue: 0 support_reps id: 1, status: busy id: 2, status: busy id: 3, status: available id: 4, status: available ====================== User 5 added to the queue. ==== Queue Status ==== Users still in queue: 0 support_reps id: 1, status: busy id: 2, status: busy id: 3, status: available id: 4, status: available ====================== User 3 has been verified and removed from the queue VerificationSession: User: 3 Rep: id: 1, status: busy Elapsed: 4.6134 User 4 has been verified and removed from the queue VerificationSession: User: 4 Rep: id: 2, status: busy Elapsed: 4.289 User 6 added to the queue. ==== Queue Status ==== Users still in queue: 0 support_reps id: 1, status: busy id: 2, status: busy id: 3, status: available id: 4, status: available ====================== User 5 has been verified and removed from the queue VerificationSession: User: 5 Rep: id: 1, status: available Elapsed: 4.2006 User 7 added to the queue. ==== Queue Status ==== Users still in queue: 0 support_reps id: 1, status: busy id: 2, status: busy id: 3, status: available id: 4, status: available ====================== User 6 has been verified and removed from the queue VerificationSession: User: 6 Rep: id: 2, status: available Elapsed: 4.0884 User 8 added to the queue. ==== Queue Status ==== Users still in queue: 0 support_reps id: 1, status: busy id: 2, status: busy id: 3, status: available id: 4, status: available ====================== User 7 has been verified and removed from the queue VerificationSession: User: 7 Rep: id: 1, status: available Elapsed: 4.0001 User 9 added to the queue. ==== Queue Status ==== Users still in queue: 0 support_reps id: 1, status: busy id: 2, status: busy id: 3, status: available id: 4, status: available ====================== User 8 has been verified and removed from the queue VerificationSession: User: 8 Rep: id: 2, status: available Elapsed: 4.0943 User 10 added to the queue. ==== Queue Status ==== Users still in queue: 0 support_reps id: 1, status: busy id: 2, status: busy id: 3, status: available id: 4, status: available ====================== ==== Queue Status ==== Users still in queue: 0 support_reps id: 1, status: busy id: 2, status: busy id: 3, status: available id: 4, status: available ====================== Elapsed Time: 19.3081 Recap Threads are still something I’m learning how to best utilize. But this was a very engaging coding challenge.\nI want to do more of these exercises regularly. They introduce me to new concepts and push me to be a better engineer. All I want is to grow my skills, both technical leadership and coding.\nHopefully along the way I can improve on how I am able to articulate how I solved the problem.. This blog post is a mess, but its better than never posting anything.\nHappy New Year, and I wish you all the best in 2023.\nJeremy\n","wordCount":"1752","inLanguage":"en","datePublished":"2023-01-03T02:12:44-06:00","dateModified":"2023-01-03T02:12:44-06:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.jeremydwayne.com/posts/threads_and_queues_in_ruby/"},"publisher":{"@type":"Organization","name":"Jeremy Winterberg - Staff Software Engineer","logo":{"@type":"ImageObject","url":"https://www.jeremydwayne.com/images/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://www.jeremydwayne.com/ accesskey=h title="Jeremy Winterberg (Alt + H)"><img src=https://www.jeremydwayne.com/images/logo.png alt aria-label=logo height=35>Jeremy Winterberg</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://www.jeremydwayne.com/newsletter/ title=newsletter><span>newsletter</span></a></li><li><a href=https://www.jeremydwayne.com/tags/ title=tags><span>tags</span></a></li><li><a href=https://www.jeremydwayne.com/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.jeremydwayne.com/>Home</a>&nbsp;»&nbsp;<a href=https://www.jeremydwayne.com/posts/>Posts</a></div><h1 class=post-title>Threads And Queues In Ruby</h1><div class=post-description>Concurrent processing in Ruby is an exciting topic which I explore in this coding exercise.</div><div class=post-meta><span title='2023-01-03 02:12:44 -0600 CST'>January 3, 2023</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/JeremyDwayne/blog/blob/main/content/posts/threads_and_queues_in_ruby.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#the-problem aria-label="The Problem">The Problem</a><ul><li><a href=#requirements aria-label=Requirements>Requirements</a></li><li><a href=#expected-output aria-label="Expected Output">Expected Output</a></li><li><a href=#provided-data aria-label="Provided data">Provided data</a></li></ul></li><li><a href=#the-attempted-solution aria-label="The Attempted Solution">The Attempted Solution</a><ul><li><a href=#lets-try-to-run-it aria-label="Let&amp;rsquo;s Try To Run It!">Let&rsquo;s Try To Run It!</a></li></ul></li><li><a href=#recap aria-label=Recap>Recap</a></li></ul></div></details></div><div class=post-content><p>I recently tried solving a coding challenge that required concurrent processing of data.
This is something I&rsquo;ve honestly never done before in code. At work, almost everything is event driven, and tasks that do
need to be done asynchronously or concurrently have been done through systems like Sidekiq, Redis or message queues like Kafka.</p><p>I want to introduce the problem to you, go over my solution, and describe my thought process along the way.. as best I can.
I&rsquo;m in no way trying to even claim I solved the problem correctly, or used Threads and Queues in the way they&rsquo;re intended.
What I can do, however, is document what I did and continue to learn and grow from here.</p><p>I found this to be incredibly engaging for me, because it was a new concept that I hadn&rsquo;t attempted to write code for before.</p><h2 id=the-problem>The Problem<a hidden class=anchor aria-hidden=true href=#the-problem>#</a></h2><p>A user&rsquo;s identity is flagged, and they must meet with a support rep to validate they are who they say they are.
Design a system that ingests the users, assigns a support rep to the case, and validates their identity.</p><h3 id=requirements>Requirements<a hidden class=anchor aria-hidden=true href=#requirements>#</a></h3><ol><li>A new user will be added to the queue every 2 seconds</li><li>An identity will be verified after 4 seconds</li><li>A support rep can only work on one validation at a time.</li></ol><h3 id=expected-output>Expected Output<a hidden class=anchor aria-hidden=true href=#expected-output>#</a></h3><ol><li><code>User &lt;ID> has been verified and removed from the queue</code></li><li>Metrics to demonstrate the progress of the queue.</li></ol><h3 id=provided-data>Provided data<a hidden class=anchor aria-hidden=true href=#provided-data>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>users</span> <span class=o>=</span> <span class=o>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>1</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>2</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>3</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>4</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>5</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>6</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>7</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>8</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>9</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>10</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>support_reps</span> <span class=o>=</span> <span class=o>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>1</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>2</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>3</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>4</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></div><h2 id=the-attempted-solution>The Attempted Solution<a hidden class=anchor aria-hidden=true href=#the-attempted-solution>#</a></h2><p>Since we&rsquo;re building out a queue data structure, we can use the Queue class that Ruby provides.
The alternative approach, and what I used initially, is to use an array as a basic queue.</p><p>Something like this technically works, but is a basic approach and isn&rsquo;t as straightforward to process in parallel.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>users</span> <span class=o>=</span> <span class=o>[]</span>
</span></span><span class=line><span class=cl><span class=n>users</span><span class=o>.</span><span class=n>push</span><span class=p>({</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>1</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>users</span><span class=o>.</span><span class=n>shift</span>
</span></span></code></pre></div><p>Once I remembered there actually is a standard Queue class, I noticed that it intrinsically supports Threads.
Threads are how I plan on processing multiple users simultaneously.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=k>class</span> <span class=nc>VerificationQueue</span>
</span></span><span class=line><span class=cl>  <span class=kp>attr_reader</span> <span class=ss>:users</span><span class=p>,</span> <span class=ss>:support_reps</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>initialize</span>
</span></span><span class=line><span class=cl>    <span class=vi>@users</span> <span class=o>=</span> <span class=no>Queue</span><span class=o>.</span><span class=n>new</span>
</span></span><span class=line><span class=cl>    <span class=vi>@support_reps</span> <span class=o>=</span> <span class=o>[]</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>verify_users</span>
</span></span><span class=line><span class=cl>    <span class=n>workers</span> <span class=o>=</span> <span class=n>support_reps</span><span class=o>.</span><span class=n>size</span><span class=o>.</span><span class=n>times</span><span class=o>.</span><span class=n>map</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>      <span class=no>Thread</span><span class=o>.</span><span class=n>new</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=k>begin</span>
</span></span><span class=line><span class=cl>          <span class=k>while</span> <span class=n>user</span> <span class=o>=</span> <span class=n>users</span><span class=o>.</span><span class=n>pop</span>
</span></span><span class=line><span class=cl>            <span class=n>support_rep</span> <span class=o>=</span> <span class=n>available_support_rep</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>support_rep</span> <span class=o>&amp;&amp;</span> <span class=n>user</span>
</span></span><span class=line><span class=cl>              <span class=n>support_rep</span><span class=o>.</span><span class=n>update_status</span><span class=p>(</span><span class=s1>&#39;busy&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=n>session</span> <span class=o>=</span> <span class=no>VerificationSession</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>user</span><span class=p>,</span> <span class=n>support_rep</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=nb>self</span><span class=o>.</span><span class=n>to_s</span>
</span></span><span class=line><span class=cl>              <span class=k>until</span><span class=p>(</span><span class=n>session</span><span class=o>.</span><span class=n>verified?</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=k>end</span>
</span></span><span class=line><span class=cl>              <span class=n>support_rep</span><span class=o>.</span><span class=n>update_status</span><span class=p>(</span><span class=s1>&#39;available&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=nb>puts</span> <span class=s2>&#34;User </span><span class=si>#{</span><span class=n>user</span><span class=o>[</span><span class=ss>:id</span><span class=o>]</span><span class=si>}</span><span class=s2> has been verified and removed from the queue&#34;</span>
</span></span><span class=line><span class=cl>              <span class=nb>puts</span> <span class=n>session</span><span class=o>.</span><span class=n>to_s</span>
</span></span><span class=line><span class=cl>            <span class=k>end</span>
</span></span><span class=line><span class=cl>          <span class=k>end</span>
</span></span><span class=line><span class=cl>        <span class=k>rescue</span> <span class=no>ThreadError</span>
</span></span><span class=line><span class=cl>        <span class=k>end</span>
</span></span><span class=line><span class=cl>      <span class=k>end</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>workers</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=o>&amp;</span><span class=ss>:join</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>available_support_rep</span>
</span></span><span class=line><span class=cl>    <span class=n>support_reps</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>ref</span><span class=o>|</span>
</span></span><span class=line><span class=cl>      <span class=k>next</span> <span class=k>if</span> <span class=n>ref</span><span class=o>.</span><span class=n>status</span> <span class=o>==</span> <span class=s1>&#39;busy&#39;</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>ref</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>add_user</span><span class=p>(</span><span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>users</span><span class=o>.</span><span class=n>push</span><span class=p>(</span><span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>puts</span> <span class=s2>&#34;User </span><span class=si>#{</span><span class=n>user</span><span class=o>[</span><span class=ss>:id</span><span class=o>]</span><span class=si>}</span><span class=s2> added to the queue.&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>add_support_rep</span><span class=p>(</span><span class=n>support_rep</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>support_reps</span><span class=o>.</span><span class=n>push</span><span class=p>(</span><span class=n>support_rep</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>puts</span> <span class=s2>&#34;support_rep </span><span class=si>#{</span><span class=n>support_rep</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2> has started working.&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>to_s</span>
</span></span><span class=line><span class=cl>    <span class=nb>puts</span> <span class=s2>&#34;==== Queue Status ====&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>puts</span> <span class=s2>&#34;Users still in queue: </span><span class=si>#{</span><span class=n>users</span><span class=o>.</span><span class=n>size</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>puts</span> <span class=s2>&#34;support_reps&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>puts</span> <span class=n>support_reps</span>
</span></span><span class=line><span class=cl>    <span class=nb>puts</span> <span class=s2>&#34;======================&#34;</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></div><p>I spin up a new thread for each support rep, so the code can verify the users simultaneously. When each support rep
becomes available again, it picks up the next user in the queue.</p><p>The algorithm I used to select an available support rep isn&rsquo;t elegant. It just loops through the reps and chooses the
next available. If I really cared about work-life balance I would implement some sort of weighted priority system that
could determine how much work each rep had taken on recently.</p><p>The verification process is managed through a VerificationSession. Due to the simplicity of the challenge, it just
tracks the time elapsed and completes after 4 seconds. In a real implementation you would trigger whatever logic would
be necessary to verify the identity of a user.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=k>class</span> <span class=nc>VerificationSession</span>
</span></span><span class=line><span class=cl>  <span class=no>TIME_COMPLETED</span> <span class=o>=</span> <span class=mi>4</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kp>attr_reader</span> <span class=ss>:user</span><span class=p>,</span> <span class=ss>:support_rep</span><span class=p>,</span> <span class=ss>:start_time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>initialize</span><span class=p>(</span><span class=n>user</span><span class=p>,</span> <span class=n>support_rep</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=vi>@user</span> <span class=o>=</span> <span class=n>user</span>
</span></span><span class=line><span class=cl>    <span class=vi>@support_rep</span> <span class=o>=</span> <span class=n>support_rep</span>
</span></span><span class=line><span class=cl>    <span class=vi>@start_time</span> <span class=o>=</span> <span class=no>Process</span><span class=o>.</span><span class=n>clock_gettime</span><span class=p>(</span><span class=no>Process</span><span class=o>::</span><span class=no>CLOCK_MONOTONIC</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>elapsed_time</span>
</span></span><span class=line><span class=cl>    <span class=n>end_time</span> <span class=o>=</span> <span class=no>Process</span><span class=o>.</span><span class=n>clock_gettime</span><span class=p>(</span><span class=no>Process</span><span class=o>::</span><span class=no>CLOCK_MONOTONIC</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>verified?</span>
</span></span><span class=line><span class=cl>    <span class=n>elapsed_time</span> <span class=o>&gt;=</span> <span class=no>TIME_COMPLETED</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>to_s</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;VerificationSession: User: </span><span class=si>#{</span><span class=n>user</span><span class=o>[</span><span class=ss>:id</span><span class=o>]</span><span class=si>}</span><span class=s2> Rep: </span><span class=si>#{</span><span class=n>support_rep</span><span class=si>}</span><span class=s2> Elapsed: </span><span class=si>#{</span><span class=n>elapsed_time</span><span class=o>.</span><span class=n>round</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></div><p>There&rsquo;s a couple of approaches we can take to build out our SupportRep objects. The first that came to mind was creating a class
which would allow future expansion of functionality. The more simplistic route would be to create a Struct. What I
struggle with in these coding challenges is the trade-offs between expressing good design and keeping the solution short
and sweet.</p><p>So first is the more traditional class route that I actually wrote, followed by how I think I would approach this in the
future with a Struct.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=k>class</span> <span class=nc>SupportRep</span>
</span></span><span class=line><span class=cl>  <span class=kp>attr_reader</span> <span class=ss>:id</span><span class=p>,</span> <span class=ss>:status</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>initialize</span><span class=p>(</span><span class=nb>id</span><span class=p>,</span> <span class=n>status</span> <span class=o>=</span> <span class=s1>&#39;available&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=vi>@id</span> <span class=o>=</span> <span class=nb>id</span>
</span></span><span class=line><span class=cl>    <span class=vi>@status</span> <span class=o>=</span> <span class=n>status</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>update_status</span><span class=p>(</span><span class=n>status</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=vi>@status</span> <span class=o>=</span> <span class=n>status</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>to_s</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;id: </span><span class=si>#{</span><span class=nb>id</span><span class=si>}</span><span class=s2>, status: </span><span class=si>#{</span><span class=n>status</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></div><p>Here&rsquo;s an example of how I might do it with a Struct.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=no>SupportRep</span> <span class=o>=</span> <span class=no>Struct</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=ss>:id</span><span class=p>,</span> <span class=ss>:status</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>queue</span> <span class=o>=</span> <span class=no>VerificationQueue</span><span class=o>.</span><span class=n>new</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nb>id</span> <span class=k>in</span> <span class=mi>1</span><span class=o>..</span><span class=mi>4</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=n>support_rep</span> <span class=o>=</span> <span class=no>SupportRep</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=nb>id</span><span class=p>,</span> <span class=s1>&#39;available&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>queue</span><span class=o>.</span><span class=n>add_support_rep</span><span class=p>(</span><span class=n>support_rep</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Then when I need to change the status I could just do</span>
</span></span><span class=line><span class=cl><span class=n>support_rep</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s1>&#39;busy&#39;</span>
</span></span></code></pre></div><p>Exploring the alternate Struct method is for another time. For now let&rsquo;s try to run it with the code as is using classes.</p><h3 id=lets-try-to-run-it>Let&rsquo;s Try To Run It!<a hidden class=anchor aria-hidden=true href=#lets-try-to-run-it>#</a></h3><p>Here is some simple code to build up the data we need to run this. In order to simulate a new user being added every 2
seconds, I also am using threads to start the validation queue and then add users to it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>users</span> <span class=o>=</span> <span class=o>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>1</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>2</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>3</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>4</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>5</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>6</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>7</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>8</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>9</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>10</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>support_reps</span> <span class=o>=</span> <span class=o>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>1</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>2</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>3</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nb>id</span><span class=p>:</span> <span class=mi>4</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>start_time</span> <span class=o>=</span> <span class=no>Process</span><span class=o>.</span><span class=n>clock_gettime</span><span class=p>(</span><span class=no>Process</span><span class=o>::</span><span class=no>CLOCK_MONOTONIC</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>queue</span> <span class=o>=</span> <span class=no>VerificationQueue</span><span class=o>.</span><span class=n>new</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>support_reps</span><span class=o>.</span><span class=n>map</span> <span class=k>do</span> <span class=o>|</span><span class=n>ref</span><span class=o>|</span> 
</span></span><span class=line><span class=cl>  <span class=n>support_rep</span> <span class=o>=</span> <span class=no>SupportRep</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>ref</span><span class=o>[</span><span class=ss>:id</span><span class=o>]</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>queue</span><span class=o>.</span><span class=n>add_support_rep</span><span class=p>(</span><span class=n>support_rep</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threads</span> <span class=o>=</span> <span class=o>[]</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>.</span><span class=n>add_user</span><span class=p>(</span><span class=n>users</span><span class=o>.</span><span class=n>shift</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threads</span> <span class=o>&lt;&lt;</span> <span class=no>Thread</span><span class=o>.</span><span class=n>new</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=k>begin</span>
</span></span><span class=line><span class=cl>    <span class=n>queue</span><span class=o>.</span><span class=n>verify_users</span>
</span></span><span class=line><span class=cl>  <span class=k>rescue</span> <span class=no>ThreadError</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threads</span> <span class=o>&lt;&lt;</span> <span class=no>Thread</span><span class=o>.</span><span class=n>new</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=k>begin</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>user</span> <span class=o>=</span> <span class=n>users</span><span class=o>.</span><span class=n>shift</span>
</span></span><span class=line><span class=cl>      <span class=n>start_time</span> <span class=o>=</span> <span class=no>Process</span><span class=o>.</span><span class=n>clock_gettime</span><span class=p>(</span><span class=no>Process</span><span class=o>::</span><span class=no>CLOCK_MONOTONIC</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>until</span><span class=p>(</span><span class=n>elapsed_time</span><span class=p>(</span><span class=n>start_time</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>2</span><span class=o>.</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>end</span>
</span></span><span class=line><span class=cl>      <span class=n>queue</span><span class=o>.</span><span class=n>add_user</span><span class=p>(</span><span class=n>user</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>  <span class=k>rescue</span> <span class=no>ThreadError</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threads</span><span class=o>.</span><span class=n>map</span> <span class=p>{</span> <span class=o>|</span><span class=n>thread</span><span class=o>|</span> <span class=n>thread</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>queue</span><span class=o>.</span><span class=n>to_s</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>elapsed_time</span><span class=p>(</span><span class=n>start_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>end_time</span> <span class=o>=</span> <span class=no>Process</span><span class=o>.</span><span class=n>clock_gettime</span><span class=p>(</span><span class=no>Process</span><span class=o>::</span><span class=no>CLOCK_MONOTONIC</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl><span class=nb>puts</span> <span class=s2>&#34;/nElapsed Time: </span><span class=si>#{</span><span class=n>elapsed_time</span><span class=p>(</span><span class=n>start_time</span><span class=p>)</span><span class=o>.</span><span class=n>round</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span></code></pre></div><p>The output is a bit messy, but you can get the gist of it. It processes 10 users in 19 seconds, each user taking 4
seconds. Without using threads, this would&rsquo;ve taken a minimum of 40 seconds. Add more support reps and it takes even
less time.</p><pre tabindex=0><code>❯ ruby threads.rb
support_rep 1 has started working.
support_rep 2 has started working.
support_rep 3 has started working.
support_rep 4 has started working.
User 1 added to the queue.
==== Queue Status ====
Users still in queue: 0
support_reps
id: 1, status: busy
id: 2, status: available
id: 3, status: available
id: 4, status: available
======================
User 2 added to the queue.
==== Queue Status ====
Users still in queue: 0
support_reps
id: 1, status: busy
id: 2, status: busy
id: 3, status: available
id: 4, status: available
======================
User 1 has been verified and removed from the queue
VerificationSession: User: 1 Rep: id: 1, status: available Elapsed: 4.0
User 3 added to the queue.
==== Queue Status ====
Users still in queue: 0
support_reps
id: 1, status: busy
id: 2, status: busy
id: 3, status: available
id: 4, status: available
======================
User 4 added to the queue.
User 2 has been verified and removed from the queue
VerificationSession: User: 2 Rep: id: 2, status: available Elapsed: 4.0
==== Queue Status ====
Users still in queue: 0
support_reps
id: 1, status: busy
id: 2, status: busy
id: 3, status: available
id: 4, status: available
======================
User 5 added to the queue.
==== Queue Status ====
Users still in queue: 0
support_reps
id: 1, status: busy
id: 2, status: busy
id: 3, status: available
id: 4, status: available
======================
User 3 has been verified and removed from the queue
VerificationSession: User: 3 Rep: id: 1, status: busy Elapsed: 4.6134
User 4 has been verified and removed from the queue
VerificationSession: User: 4 Rep: id: 2, status: busy Elapsed: 4.289
User 6 added to the queue.
==== Queue Status ====
Users still in queue: 0
support_reps
id: 1, status: busy
id: 2, status: busy
id: 3, status: available
id: 4, status: available
======================
User 5 has been verified and removed from the queue
VerificationSession: User: 5 Rep: id: 1, status: available Elapsed: 4.2006
User 7 added to the queue.
==== Queue Status ====
Users still in queue: 0
support_reps
id: 1, status: busy
id: 2, status: busy
id: 3, status: available
id: 4, status: available
======================
User 6 has been verified and removed from the queue
VerificationSession: User: 6 Rep: id: 2, status: available Elapsed: 4.0884
User 8 added to the queue.
==== Queue Status ====
Users still in queue: 0
support_reps
id: 1, status: busy
id: 2, status: busy
id: 3, status: available
id: 4, status: available
======================
User 7 has been verified and removed from the queue
VerificationSession: User: 7 Rep: id: 1, status: available Elapsed: 4.0001
User 9 added to the queue.
==== Queue Status ====
Users still in queue: 0
support_reps
id: 1, status: busy
id: 2, status: busy
id: 3, status: available
id: 4, status: available
======================
User 8 has been verified and removed from the queue
VerificationSession: User: 8 Rep: id: 2, status: available Elapsed: 4.0943
User 10 added to the queue.
==== Queue Status ====
Users still in queue: 0
support_reps
id: 1, status: busy
id: 2, status: busy
id: 3, status: available
id: 4, status: available
======================
==== Queue Status ====
Users still in queue: 0
support_reps
id: 1, status: busy
id: 2, status: busy
id: 3, status: available
id: 4, status: available
======================
Elapsed Time: 19.3081
</code></pre><h2 id=recap>Recap<a hidden class=anchor aria-hidden=true href=#recap>#</a></h2><p>Threads are still something I&rsquo;m learning how to best utilize. But this was a very engaging coding challenge.</p><p>I want to do more of these exercises regularly. They introduce me to new concepts and push me to be a better engineer.
All I want is to grow my skills, both technical leadership and coding.</p><p>Hopefully along the way I can improve on how I am able to articulate how I solved the problem.. This blog post is a
mess, but its better than never posting anything.</p><p>Happy New Year, and I wish you all the best in 2023.</p><p>Jeremy</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.jeremydwayne.com/tags/post/>post</a></li></ul><nav class=paginav><a class=next href=https://www.jeremydwayne.com/posts/two-promotions-in-8-months/><span class=title>Next »</span><br><span>I'm a staff software engineer now? Two Promotions in 8 Months</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Threads And Queues In Ruby on twitter" href="https://twitter.com/intent/tweet/?text=Threads%20And%20Queues%20In%20Ruby&url=https%3a%2f%2fwww.jeremydwayne.com%2fposts%2fthreads_and_queues_in_ruby%2f&hashtags=post"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Threads And Queues In Ruby on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.jeremydwayne.com%2fposts%2fthreads_and_queues_in_ruby%2f&title=Threads%20And%20Queues%20In%20Ruby&summary=Threads%20And%20Queues%20In%20Ruby&source=https%3a%2f%2fwww.jeremydwayne.com%2fposts%2fthreads_and_queues_in_ruby%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Threads And Queues In Ruby on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.jeremydwayne.com%2fposts%2fthreads_and_queues_in_ruby%2f&title=Threads%20And%20Queues%20In%20Ruby"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Threads And Queues In Ruby on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.jeremydwayne.com%2fposts%2fthreads_and_queues_in_ruby%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Threads And Queues In Ruby on whatsapp" href="https://api.whatsapp.com/send?text=Threads%20And%20Queues%20In%20Ruby%20-%20https%3a%2f%2fwww.jeremydwayne.com%2fposts%2fthreads_and_queues_in_ruby%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Threads And Queues In Ruby on telegram" href="https://telegram.me/share/url?text=Threads%20And%20Queues%20In%20Ruby&url=https%3a%2f%2fwww.jeremydwayne.com%2fposts%2fthreads_and_queues_in_ruby%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.jeremydwayne.com/>Jeremy Winterberg - Staff Software Engineer</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>